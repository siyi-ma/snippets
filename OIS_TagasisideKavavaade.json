{"name":"OIS_TagasisideKavavaade","version":"1.0","culture":"en-US","modifiedTime":"2025-04-28T11:31:35.935072+00:00","ppdf:outputFileFormat":"parquet","ppdf:dataflowId":"6bdd6a40-06ed-41a3-85f3-7b84dbee3b9c","ppdf:owner":{"tenantId":"3efd4d88-9b88-4fc9-b6c0-c7ca50f1db57","userId":"84427c2b-9e9c-4069-a4ef-32e34b3e92fb"},"ppdf:fastCopy":true,"pbi:mashup":{"fastCombine":false,"allowNativeQueries":true,"queriesMetadata":{"_folderAA_stat":{"queryId":"3e55cb73-1ae5-4105-9847-2ae5616e13ce","queryName":"_folderAA_stat"},"_folderOIS":{"queryId":"c82ef089-e89b-446c-9c88-485b85529706","queryName":"_folderOIS"},"stage_dataflow_keskhindedKomentaarid":{"queryId":"02f6d9c5-e022-491a-a861-c8ba2073327b","queryName":"stage_dataflow_keskhindedKomentaarid"},"fakt_komments_kavavaade":{"queryId":"937815df-1ff3-48ba-bf3a-b0af55f9872a","queryName":"fakt_komments_kavavaade","loadEnabled":true},"dim_kysimus":{"queryId":"722e74ef-b54a-4a7e-b99a-6c573ae453a6","queryName":"dim_kysimus","loadEnabled":true},"dim_oppekava":{"queryId":"aaaede3b-81e3-40a5-94bd-b4cd0a8c1fc7","queryName":"dim_oppekava","loadEnabled":true},"dim_semester":{"queryId":"7b731f12-da59-44e5-bce8-7ec0cec9b274","queryName":"dim_semester","loadEnabled":true},"rls_email_kava":{"queryId":"72f4c40e-6571-4f7e-bbcf-863b99f559df","queryName":"rls_email_kava","loadEnabled":true},"_lookupOppekavaAined":{"queryId":"e2b23966-d67e-49f3-bfc9-97e9899de924","queryName":"_lookupOppekavaAined"}},"document":"section Section1;\r\nshared _folderAA_stat = let\n    Source = SharePoint.Contents(\"https://livettu.sharepoint.com/sites/M_admin\"),\n    Documents = Source{[Name=\"Documents\"]}[Content],\n    A_A_Statistika = Documents{[Name=\"A_A_Statistika\"]}[Content]\nin \n    A_A_Statistika;\r\nshared _folderOIS = let\n    Source = SharePoint.Contents(\"https://livettu-my.sharepoint.com/personal/siyi_ma_taltech_ee\"),\n    Documents = Source{[Name=\"Documents\"]}[Content], \n    folderOIS = Documents{[Name=\"OIS\"]}[Content]\nin\n  folderOIS;\r\nshared stage_dataflow_keskhindedKomentaarid = let\r\n  Source = PowerPlatform.Dataflows([]),\r\n  #\"Navigation 1\" = Source{[Id = \"Workspaces\"]}[Data],\r\n  #\"Navigation 2\" = #\"Navigation 1\"{[workspaceId = \"b9ba0143-b2c1-4295-a8d9-0844282bd555\"]}[Data],\r\n  #\"Navigation 3\" = #\"Navigation 2\"{[dataflowId = \"a7ba86fe-494a-4eba-b347-94267613c4a4\"]}[Data],\r\n  #\"Navigation 4\" = #\"Navigation 3\"{[entity = \"fakt_keskhindedKomentaarid\", version = \"\"]}[Data]\r\nin\r\n  #\"Navigation 4\";\r\nshared fakt_komments_kavavaade = let\n    Source = stage_dataflow_keskhindedKomentaarid,\n        mergeKavadeAined = Table.NestedJoin(Source, {\"ainekood\"}, _lookupOppekavaAined, {\"Kood\"}, \"_lookupOppekavaAined\", JoinKind.LeftOuter),\n    #\"Expanded _lookupOppekavaAined\" = Table.ExpandTableColumn(mergeKavadeAined, \"_lookupOppekavaAined\", {\"kavaKoond\"}, {\"kavaKoond\"}),\n    #\"Split Column by Delimiter\" = Table.ExpandListColumn(Table.TransformColumns(#\"Expanded _lookupOppekavaAined\", {{\"kavaKoond\", Splitter.SplitTextByDelimiter(\", \", QuoteStyle.None), let itemType = (type nullable text) meta [Serialized.Text = true] in type {itemType}}}), \"kavaKoond\"),\n    #\"Changed Type\" = Table.TransformColumnTypes(#\"Split Column by Delimiter\",{{\"kavaKoond\", type text}}),\n    #\"Renamed Columns\" = Table.RenameColumns(#\"Changed Type\",{{\"kavaKoond\", \"oppekava\"}, {\"kommentaar\", \"kommentaarKavavaade\"}}),\n    #\"Replaced Value\" = Table.ReplaceValue(#\"Renamed Columns\",null,\"NA\",Replacer.ReplaceValue,{\"oppekava\"}),\n    #\"Added Custom\" = Table.AddColumn(#\"Replaced Value\", \"display\", each if [kava] = [oppekava]  or [kava]=\"-\" then 1 else 0, Int64.Type)\nin\n    #\"Added Custom\";\r\nshared dim_kysimus = let\nSource = _folderAA_stat,\ngetExcel = Excel.Workbook(Source{[Name=\"OIS_kysitlus_kommentaarid_alatesS20.xlsx\"]}[Content]){[Name=\"kysimus\"]}[Data],\n    #\"Filtered Rows\" = Table.SelectRows(getExcel, each ([kategooria] = \"õppetegevus\")),\n    #\"Removed Columns\" = Table.RemoveColumns(#\"Filtered Rows\",{\"kategooria\"})\nin\n    #\"Removed Columns\";\r\nshared dim_oppekava = let\n    Source = Table.Distinct(  Table.SelectColumns( fakt_komments_kavavaade, \"oppekava\"))\nin\n    Source;\r\nshared dim_semester = let\n  Source = fakt_komments_kavavaade,\n  distinctSemester = Table.Distinct(Table.SelectColumns( Source, {\"semester\"})),\n  duplicateSemester = Table.DuplicateColumn(distinctSemester, \"semester\", \"semester - Copy\"),\n  splitSemester = Table.SplitColumn(duplicateSemester, \"semester - Copy\", Splitter.SplitTextByDelimiter(\" - \"), {\"oppeaasta\", \"sk\"}),\n  addSem = Table.Sort(Table.AddColumn(splitSemester, \"sem\", each if Text.Start([sk],1) = \"s\" then Text.Range([oppeaasta],2,2)&\"S\" else Text.Range([oppeaasta],7,2)&\"K\", type text), {{\"sem\", Order.Ascending}})\nin\n  addSem;\r\nshared rls_email_kava = let\n    Source = _folderOIS,\n    getExcel = Excel.Workbook(Source{[Name=\"Püsiandmed.xlsx\"]}[Content], true, true),\n    getTbl = getExcel{[Name=\"rls_user\"]}[Data],\n    #\"Removed Other Columns\" = Table.SelectColumns(getTbl,{\"role\", \"email\", \"rls_kava\", \"oppetase\", \"access\", \"M_oisTagasisideKavaVaade\"}),\n    #\"Filtered Rows\" = Table.SelectRows(#\"Removed Other Columns\", each ([rls_kava] <> \"none\") and ([role] <> \"assistant\" and [role] <> \"ID\" and [role] <> \"Projektijuht\" and [role] <> \"Teadusprodekaan\")),\n    #\"Changed Type\" = Table.TransformColumnTypes(#\"Filtered Rows\",{{\"email\", type text}, {\"rls_kava\", type text}, {\"oppetase\", type text}, {\"role\", type text}, {\"access\", Int64.Type}, {\"M_oisTagasisideKavaVaade\", Int64.Type}})\nin\n    #\"Changed Type\";\r\nshared _lookupOppekavaAined = let\n    Source = SharePoint.Contents(\"https://livettu.sharepoint.com/sites/M_admin\"),\n    Documents = Source{[Name=\"Documents\"]}[Content],\n    folderA = Documents{[Name=\"A_Õppetegevuse failid\"]}[Content],\n    oppekavad = folderA {[Name=\"Õppekavad\"]}[Content],\n    getExcel = Excel.Workbook( oppekavad {[Name=\"Õppekavades_ained.xlsx\"]}[Content], true, true),\n    kavaKoond_DefinedName = getExcel{[Item=\"kavaKoond\",Kind=\"DefinedName\"]}[Data],\n    #\"Changed Type\" = Table.TransformColumnTypes(kavaKoond_DefinedName,{{\"Kood\", type text}, {\"Õppeaine nimetus e.k\", type text}, {\"EAP\", Int64.Type}, {\"kavaKoond\", type text}, {\"summary_K_V\", type text}, {\"kava_KV_mitukorda\", type text}}),\n    #\"Removed Other Columns\" = Table.SelectColumns(#\"Changed Type\",{\"Kood\", \"Õppeaine nimetus e.k\", \"kavaKoond\"})\nin \n    #\"Removed Other Columns\";\r\n","connectionOverrides":[{"path":"https://livettu.sharepoint.com/sites/M_admin","kind":"SharePoint","provider":"CdsA","authenticationKind":null,"environmentName":null,"apiName":null,"connectionName":"{\"kind\":\"SharePoint\",\"path\":\"https://livettu.sharepoint.com/sites/M_admin\"}","audience":null},{"path":"https://livettu-my.sharepoint.com/personal/siyi_ma_taltech_ee","kind":"SharePoint","provider":"CdsA","authenticationKind":null,"environmentName":null,"apiName":null,"connectionName":"{\"kind\":\"SharePoint\",\"path\":\"https://livettu-my.sharepoint.com/personal/siyi_ma_taltech_ee\"}","audience":null},{"path":"PowerPlatformDataflows","kind":"PowerPlatformDataflows","provider":"CdsA","authenticationKind":null,"environmentName":null,"apiName":null,"connectionName":"{\"kind\":\"PowerPlatformDataflows\",\"path\":\"PowerPlatformDataflows\"}","audience":null}]},"entities":[{"$type":"LocalEntity","name":"fakt_komments_kavavaade","description":"","pbi:refreshPolicy":{"$type":"FullRefreshPolicy","location":"fakt_komments_kavavaade.parquet"},"annotations":[{"name":"ppdf:entityKeys","value":"[]"}],"attributes":[{"name":"teaduskond","dataType":"string"},{"name":"kava","dataType":"string"},{"name":"ainekood","dataType":"string"},{"name":"küsimus","dataType":"string"},{"name":"õppejõu andmed","dataType":"string"},{"name":"hinne","dataType":"int64"},{"name":"kommentaarKavavaade","dataType":"string"},{"name":"oppejoukey","dataType":"string"},{"name":"semester","dataType":"string"},{"name":"instituudikood","dataType":"string"},{"name":"oppekava","dataType":"string"},{"name":"display","dataType":"int64"}]},{"$type":"LocalEntity","name":"dim_kysimus","description":"","pbi:refreshPolicy":{"$type":"FullRefreshPolicy","location":"dim_kysimus.parquet"},"annotations":[{"name":"ppdf:entityKeys","value":"[]"}],"attributes":[{"name":"tüüp","dataType":"string"},{"name":"küsimus","dataType":"string"},{"name":"tüüp1","dataType":"string"},{"name":"küsimus1","dataType":"string"},{"name":"sort","dataType":"double"}]},{"$type":"LocalEntity","name":"dim_oppekava","description":"","pbi:refreshPolicy":{"$type":"FullRefreshPolicy","location":"dim_oppekava.parquet"},"annotations":[{"name":"pbi:EntityTypeDisplayHint","value":"CalculatedEntity"},{"name":"ppdf:entityKeys","value":"[{\"columns\":[\"oppekava\"]}]"}],"attributes":[{"name":"oppekava","dataType":"string"}]},{"$type":"LocalEntity","name":"dim_semester","description":"","pbi:refreshPolicy":{"$type":"FullRefreshPolicy","location":"dim_semester.parquet"},"annotations":[{"name":"pbi:EntityTypeDisplayHint","value":"CalculatedEntity"},{"name":"ppdf:entityKeys","value":"[{\"columns\":[\"semester\"]}]"}],"attributes":[{"name":"semester","dataType":"string"},{"name":"oppeaasta","dataType":"string"},{"name":"sk","dataType":"string"},{"name":"sem","dataType":"string"}]},{"$type":"LocalEntity","name":"rls_email_kava","description":"","pbi:refreshPolicy":{"$type":"FullRefreshPolicy","location":"rls_email_kava.parquet"},"annotations":[{"name":"ppdf:entityKeys","value":"[]"}],"attributes":[{"name":"role","dataType":"string"},{"name":"email","dataType":"string"},{"name":"rls_kava","dataType":"string"},{"name":"oppetase","dataType":"string"},{"name":"access","dataType":"int64"},{"name":"M_oisTagasisideKavaVaade","dataType":"int64"}]}]}
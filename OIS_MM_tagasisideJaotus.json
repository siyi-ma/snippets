{"name":"OIS_MM_tagasisideJaotus","version":"1.0","culture":"en-US","modifiedTime":"2025-02-27T10:08:45.1599553+00:00","ppdf:outputFileFormat":"parquet","ppdf:dataflowId":"ea325eaa-23c7-4fd6-8096-29676d98d7f4","ppdf:owner":{"tenantId":"3efd4d88-9b88-4fc9-b6c0-c7ca50f1db57","userId":"84427c2b-9e9c-4069-a4ef-32e34b3e92fb"},"ppdf:fastCopy":true,"pbi:mashup":{"fastCombine":false,"allowNativeQueries":true,"queriesMetadata":{"_folderOppejoudeKoondtabel":{"queryId":"5afb3a3f-fb56-42a1-8f0f-e4a68de164ff","queryName":"_folderOppejoudeKoondtabel","queryGroupId":"28f5432a-6996-4545-bf10-d2c5cdf1ecfa"},"oppejouKoond":{"queryId":"aac5f91d-5a29-4fdc-8c95-4ec0fcd234b0","queryName":"oppejouKoond"},"_foldefAineteKoondtbl":{"queryId":"274a5dea-c213-4163-8d93-b9872bfe1403","queryName":"_foldefAineteKoondtbl","queryGroupId":"28f5432a-6996-4545-bf10-d2c5cdf1ecfa"},"aineteKoondtabel":{"queryId":"bd6145fb-6518-4711-893b-acc82b3a9e18","queryName":"aineteKoondtabel"},"_folderA_A_Statistika":{"queryId":"4e0a8be8-2fe4-43dc-83ca-e18aa91b2f3b","queryName":"_folderA_A_Statistika","queryGroupId":"28f5432a-6996-4545-bf10-d2c5cdf1ecfa"},"fnMMCleanComments":{"queryId":"a642a224-6e5c-4793-b9e9-98903a05fc27","queryName":"fnMMCleanComments"},"fnMMCleanComments_alatesK23":{"queryId":"1ca01317-c97a-4697-9232-2518319f8813","queryName":"fnMMCleanComments_alatesK23"},"_folderKeskhindedKomentaarid":{"queryId":"59fc7563-40b6-4e5f-a52d-95767e7eefbb","queryName":"_folderKeskhindedKomentaarid","queryGroupId":"28f5432a-6996-4545-bf10-d2c5cdf1ecfa"},"MMkeskhinded_ja_komments":{"queryId":"0256ffbe-0c32-4bf4-9baf-0038c62b8bba","queryName":"MMkeskhinded_ja_komments","loadEnabled":true},"MMettevotlus_alates24K":{"queryId":"d81631a3-de88-4788-b3a2-4cd4b6e215c6","queryName":"MMettevotlus_alates24K","loadEnabled":true},"_test_keskhindedKommentaar":{"queryId":"58acdce0-c025-481e-9e7d-47b70c516f52","queryName":"_test_keskhindedKommentaar","queryGroupId":"28f5432a-6996-4545-bf10-d2c5cdf1ecfa"},"_folder_M_oppetoo":{"queryId":"aad27bcd-65eb-41c1-bc6d-02114305e30f","queryName":"_folder_M_oppetoo","queryGroupId":"28f5432a-6996-4545-bf10-d2c5cdf1ecfa"},"_lookupMMoppjoujaotus":{"queryId":"41220ed0-e4d1-4bc0-b69b-18ed8e3a330b","queryName":"_lookupMMoppjoujaotus","queryGroupId":"28f5432a-6996-4545-bf10-d2c5cdf1ecfa"}},"document":"section Section1;\r\nshared _folderOppejoudeKoondtabel = let\n    Source = SharePoint.Contents(\"https://livettu-my.sharepoint.com/personal/siyi_ma_taltech_ee\"),\n    Documents = Source{[Name=\"Documents\"]}[Content], \n    folderOIS = Documents{[Name=\"ÕIS\"]}[Content],\n    tagasiside= folderOIS{[Name=\"Tagasiside\"]}[Content],\n    oppejoudKoondtbl = tagasiside {[Name = \"õppejõudude koondtabel\"]} [Content]\nin oppejoudKoondtbl;\r\nshared oppejouKoond = let\n    Source = _folderOppejoudeKoondtabel,\n    addKysimus = Table.AddColumn(Source, \"kysimus\", each let value = Text.BetweenDelimiters([Name], \"(\", \")\"), \noutput = try Number.FromText(value) otherwise null, \noutput1 = if Text.Contains([Name], \"(\") then output else 0 in output1, Int64.Type),\n    Custom2 = Table.TransformColumns(addKysimus, {\"Name\", each Text.Start(_,15),type text}),\n    addSemester = Table.AddColumn(Custom2, \"semester\", each let value = Text.Upper(Text.Middle([Name],10,1)), aasta1 = Text.Middle([Name], 2,2), aasta2 = Text.Middle([Name], 7,2), \n        result = if value =\"S\" then aasta1&value else aasta2&value \n        in result, type text),\n    #\"Sorted Rows1\" = Table.Sort(addSemester,{{\"semester\", Order.Descending}}),\n    Custom1 = Table.AddColumn(#\"Sorted Rows1\", \"Custom\", each if [Extension] = \".xls\" then \nTable.ReplaceValue(Table.PromoteHeaders(Table.RemoveFirstN(Excel.Workbook([Content], null, true){0}[Data],1)), \n\".\",\",\",Replacer.ReplaceText,{\"keskmine\", \"vastanute protsent(%)\"}) else \nTable.RenameColumns(Table.ReplaceValue(Table.PromoteHeaders(Table.RemoveFirstN( Csv.Document([Content], [Delimiter=\";\", Columns=9, Encoding =65001]),1)), \".\",\",\",Replacer.ReplaceText,{\"keskmine\", \"vastanute protsent(%) \"}), {\"vastanute protsent(%) \",  \"vastanute protsent(%)\"}),\ntype table),\n    #\"Removed Other Columns\" = Table.SelectColumns(Custom1,{\"Custom\", \"semester\", \"kysimus\"}),\n    #\"Expanded Custom\" = Table.ExpandTableColumn(#\"Removed Other Columns\", \"Custom\", {\"nimi\", \"perenimi\", \"keskmine\", \"teaduskond\", \"instituut\", \"deklareerinute arv\", \"vastanute arv\", \"vastanute protsent(%)\"}, {\"nimi\", \"perenimi\", \"keskmine\", \"teaduskond\", \"instituut\", \"deklareerinute arv\", \"vastanute arv\", \"vastanute protsent(%)\"}),\n    #\"Replaced Value\" = Table.ReplaceValue(#\"Expanded Custom\",\".\",\",\",Replacer.ReplaceText,{\"keskmine\", \"vastanute protsent(%)\"}),\n    #\"Changed Type\" = Table.TransformColumnTypes(#\"Replaced Value\",{{\"nimi\", type text}, {\"perenimi\", type text}, {\"keskmine\", type number}, {\"teaduskond\", type text}, {\"instituut\", type text}, {\"deklareerinute arv\", Int64.Type}, {\"vastanute arv\", Int64.Type}, {\"vastanute protsent(%)\", type number}}),\n    #\"Sorted Rows\" = Table.Sort(#\"Changed Type\",{{\"semester\", Order.Descending}})\nin\n    #\"Sorted Rows\";\r\nshared _foldefAineteKoondtbl = let\n    Source = SharePoint.Contents(\"https://livettu-my.sharepoint.com/personal/siyi_ma_taltech_ee\"),\n    Documents = Source{[Name=\"Documents\"]}[Content], \n    folderOIS = Documents{[Name=\"ÕIS\"]}[Content],\n    tagasiside = folderOIS{[Name=\"Tagasiside\"]}[Content],\n    aineteKoondtbl = tagasiside {[Name=\"ainete koondtabel\"]}[Content],\n    filterRows =\n        Table.SelectRows(aineteKoondtbl, \n            each Text.Length([Name])<=37)\nin\n    filterRows;\r\nshared aineteKoondtabel = let\n    Source = _foldefAineteKoondtbl,\n    #\"Added Custom\" = Table.AddColumn(Source, \"Custom\", each fxCleanKoondTable(Excel.Workbook([Content]){0}[Data])),\n    addSemester = Table.SelectColumns(\nTable.AddColumn(#\"Added Custom\", \"semester\", each let value = Text.Upper(Text.Middle([Name],10,1)), aasta1 = Text.Middle([Name], 2,2), aasta2 = Text.Middle([Name], 7,2), \n        result = if value =\"S\" then aasta1&value else aasta2&value \n        in result, type text), \n{\"Custom\", \"semester\"}),\n    #\"Expanded Custom.1\" = Table.ExpandTableColumn(addSemester, \"Custom\", {\"aine nimetus\", \"ainekood\", \"keskmine\", \"deklareerinute arv\", \"vastanute arv\", \"vastanute protsent(%)\"}, {\"aine nimetus\", \"ainekood\", \"keskmine\", \"deklareerinute arv\", \"vastanute arv\", \"vastanute protsent(%)\"}),\n    #\"Changed Type\" = Table.TransformColumnTypes(#\"Expanded Custom.1\",{{\"aine nimetus\", type text}, {\"ainekood\", type text}, {\"keskmine\", type number}, {\"deklareerinute arv\", Int64.Type}, {\"vastanute arv\", Int64.Type}, {\"vastanute protsent(%)\", type number}}),\n    #\"Added Custom1\" = Table.AddColumn(#\"Changed Type\", \"key\", each [ainekood]&[semester], type text)\nin\n    #\"Added Custom1\";\r\nshared _folderA_A_Statistika = let\n    Source = SharePoint.Contents(\"https://livettu.sharepoint.com/sites/M_admin\"),\n    Documents = Source{[Name=\"Documents\"]}[Content],\n    A_A_Statistika = Documents{[Name=\"A_A_Statistika\"]}[Content]\nin \n    A_A_Statistika;\r\nshared fnMMCleanComments = let\r\n  fnMMCleanComments = (input as binary) =>\nlet\n  Source = input,\n  importCsv = Table.PromoteHeaders(Csv.Document(Source, [Delimiter = \";\", Columns = 7, Encoding = 65001, QuoteStyle = QuoteStyle.None])),\n  extractKava = \n    Table.TransformColumnTypes(\n      Table.RenameColumns(\n        Table.TransformColumns(importCsv, {{\"teaduskond\", each Text.Start(_, 1), type text}, {\"kava versiooni nimetus \", each Text.Start(_,4)}}), \n        {{\"kava versiooni nimetus \", \"kava\"}, {\"kommentaar \", \"kommentaar\"}, {\"küsimus\", \"kysimus\"}, {\"õppejõu andmed\", \"oppejou\"}}), \n      {{\"kava\", type text}, {\"ainekood\", type text}, {\"hinne\", Int64.Type}, {\"kommentaar\", type text}}),\n  addKey = Table.AddColumn(extractKava, \"oppejoukey\", each Text.Select(Text.Lower([oppejou]), {\"a\"..\"z\"}), type text),\n  selectMMoppjoud = Table.SelectRows( addKey, each List.PositionOf(List.Buffer(_lookupMMoppjoujaotus), [oppejoukey])>=0),\n  #\"Grouped rows\" = Table.Group(selectMMoppjoud, {\"teaduskond\", \"kava\", \"ainekood\", \"kysimus\", \"oppejou\", \"oppejoukey\"}, {{\"arv\", each Table.RowCount(_), Int64.Type}, {\"keskmineHinne\", each List.Average(_[hinne]), type number}, {\"kommentaarKoond\", each Text.Combine(List.Transform(_[kommentaar], Text.From), \" | #(lf)\"), type text}})\nin #\"Grouped rows\"\r\nin\r\n  fnMMCleanComments;\r\nshared fnMMCleanComments_alatesK23 = let\r\n  fnMMCleanComments_alatesK23 = (input as binary) =>\nlet\n  Source = input,\n  importCsv = Table.PromoteHeaders(Csv.Document(Source, [Delimiter = \";\", Columns = 7, Encoding = 65001, QuoteStyle = QuoteStyle.None])),\n  extractKava = \n    Table.TransformColumnTypes(\n      Table.RenameColumns(\n        Table.TransformColumns(importCsv, {{\"teaduskond\", each Text.Start(_, 1), type text}, {\"kava versiooni nimetus \", each Text.Start(_,4)}}), \n        {{\"kava versiooni nimetus \", \"kava\"}, {\"kommentaar \", \"kommentaar\"}, {\"väide\", \"kysimus\"}, {\"vastus\", \"hinne\"}, {\"õppejõu andmed\", \"oppejou\"}}), \n      {{\"kava\", type text}, {\"ainekood\", type text}, {\"hinne\", Int64.Type}, {\"kommentaar\", type text}}),\n  addKey = Table.AddColumn(extractKava, \"oppejoukey\", each Text.Select(Text.Lower([oppejou]), {\"a\"..\"z\"}), type text),\n  selectMMoppjoud = Table.SelectRows( addKey, each List.PositionOf(List.Buffer(_lookupMMoppjoujaotus), [oppejoukey])>=0),\n  #\"Grouped rows\" = Table.Group(selectMMoppjoud, {\"teaduskond\", \"kava\", \"ainekood\", \"kysimus\", \"oppejou\", \"oppejoukey\"}, {{\"arv\", each Table.RowCount(_), Int64.Type}, {\"keskmineHinne\", each List.Average(_[hinne]), type number}, {\"kommentaarKoond\", each Text.Combine(List.Transform(_[kommentaar], Text.From), \" | #(lf)\"), type text}})\nin #\"Grouped rows\"\r\nin\r\n  fnMMCleanComments_alatesK23;\r\nshared _folderKeskhindedKomentaarid = let\n    Source = SharePoint.Contents(\"https://livettu-my.sharepoint.com/personal/siyi_ma_taltech_ee\"),\n    Documents = Source{[Name=\"Documents\"]}[Content], \n    folderOIS = Documents{[Name=\"ÕIS\"]}[Content],\n    tagasiside= folderOIS{[Name=\"Tagasiside\"]}[Content],\n    keskhindedKomments = Table.TransformColumns(\n        Table.SelectRows(tagasiside, each Text.Contains([Name], \"keskhinded_ja_kommentaarid.csv\")),\n            {{\"Name\", each Text.Start(_, 15), type text}})\n// Folder.Files(\"C:\\Users\\siyi.ma\\OneDrive - TalTech\\ÕIS\\Tagasiside\")\nin keskhindedKomments;\r\nshared MMkeskhinded_ja_komments = let\n    Source = _folderKeskhindedKomentaarid,\n    addSemester = Table.AddColumn( Source, \"semester\", each let value = Text.Upper(Text.Middle([Name],10,1)), aasta1 = Text.Middle([Name], 2,2), aasta2 = Text.Middle([Name], 7,2), \n        result = if value =\"S\" then aasta1&value else aasta2&value in result, type text),\n    fnMMcleanComments = Table.AddColumn(addSemester, \"Custom\", each if Number.FromText( Text.Start([semester], 2))>=23 then fnMMCleanComments_alatesK23([Content]) else fnMMCleanComments([Content])),\n    #\"Removed Other Columns\" = Table.SelectColumns(fnMMcleanComments,{\"Custom\", \"semester\"}),\n    #\"Expanded Custom\" = Table.ExpandTableColumn(#\"Removed Other Columns\", \"Custom\", \n      {\"teaduskond\",  \"kava\", \"ainekood\", \"kysimus\", \"oppejou\", \"oppejoukey\", \"arv\", \"keskmineHinne\", \"kommentaarKoond\"}, \n      {\"teaduskond\",  \"kava\", \"ainekood\", \"kysimus\", \"oppejou\", \"oppejoukey\", \"arv\", \"keskmineHinne\", \"kommentaarKoond\"}),\r\n  #\"Changed column type\" = Table.TransformColumnTypes(#\"Expanded Custom\", {{\"teaduskond\", type text}, {\"kava\", type text}, {\"ainekood\", type text}, {\"kysimus\", type text}, {\"oppejou\", type text}, {\"oppejoukey\", type text}, {\"arv\", Int64.Type}, {\"keskmineHinne\", type number}, {\"kommentaarKoond\", type text}})\nin\n  #\"Changed column type\";\r\nshared MMettevotlus_alates24K = let\r\n  Source = MMkeskhinded_ja_komments,\r\n  Custom = Table.SelectRows( Source, each Number.FromText(Text.Start([semester],2))>=24),\r\n  addTase = Table.AddColumn(Custom, \"tase\", each let \n    range = Text.Range([kava],3,1),\n    result = try if [teaduskond] =\"TA\" then \"avatud ülikool\" else \n    if range = \"B\" then \"BAK\" else \n    if range = \"M\" then \"MAG\" else\n    if range = \"R\" then \"RAK\" else\n    if range = \"I\" then \"INT\" else\n    if range = \"D\" then \"DOK\" else \"null\"\n    otherwise \"erasmus\"\n    in result, type text),\r\n  addOppegrupp = Table.AddColumn(addTase, \"oppegrupp\", each let\n    maj = if [teaduskond] = \"M\" then \"Majandus\" else \"Mitte_Maj\",\n    result = maj&\"_\"&[tase] in result, type text)\r\nin\r\n  addOppegrupp;\r\nshared _test_keskhindedKommentaar = let\n    Source = _folderKeskhindedKomentaarid\n// Folder.Files(\"C:\\Users\\siyi.ma\\OneDrive - TalTech\\ÕIS\\Tagasiside\")\r\n  ,\r\n  Navigation = Source{8}[Content],\r\n  #\"Imported CSV\" = Csv.Document(Navigation, [Delimiter = \";\", Columns = 7, Encoding = 65001, QuoteStyle = QuoteStyle.None]),\r\n  #\"Promoted headers\" = Table.PromoteHeaders(#\"Imported CSV\", [PromoteAllScalars = true]),\r\n  #\"Extracted first characters\" = Table.TransformColumnTypes( Table.RenameColumns( Table.TransformColumns(#\"Promoted headers\", {{\"teaduskond\", each Text.Start(_, 1), type text}, {\"kava versiooni nimetus \", each Text.Start(_,4)}}), \r\n{{\"kava versiooni nimetus \", \"kava\"}, {\"kommentaar \", \"kommentaar\"}, {\"väide\", \"küsimus\"}, {\"vastus\", \"hinne\"}}), \r\n {{\"kava\", type text}, {\"ainekood\", type text}, {\"hinne\", Int64.Type}, {\"kommentaar\", type text}}),\r\n  addKey = Table.AddColumn(#\"Extracted first characters\", \"nimikey\", each Text.Select(Text.Lower([õppejõu andmed]), {\"a\"..\"z\"}), type text),\r\n  selectMMoppjoud = Table.SelectRows( addKey, each List.PositionOf(List.Buffer(_lookupMMoppjoujaotus), [nimikey])>=0),\r\n  #\"Grouped rows\" = Table.Group(selectMMoppjoud, {\"teaduskond\", \"kava\", \"ainekood\", \"küsimus\", \"õppejõu andmed\", \"nimikey\"}, {{\"arv\", each Table.RowCount(_), Int64.Type}, {\"keskmineHinne\", each List.Average(_[hinne]), type number}, {\"kommentaarKoond\", each Text.Combine(List.Transform(_[kommentaar], Text.From), \" | #(lf)\"), type text}})\nin #\"Grouped rows\";\r\nshared _folder_M_oppetoo = let\n    Source = SharePoint.Contents(\"https://livettu.sharepoint.com/sites/M_Dashboard\"),\n    M_oppetoo = Source{[Name=\"M_õppetöö\"]}[Content]\nin\n    M_oppetoo;\r\nshared _lookupMMoppjoujaotus = let\n    Source = _folder_M_oppetoo,\n    #\"MM_oppejoujaotust xlsx\" = Source{[Name=\"MM_oppejoujaotust.xlsx\"]}[Content],\n    #\"Imported Excel Workbook\" = Excel.Workbook(#\"MM_oppejoujaotust xlsx\", true),\n    getMMtbl = #\"Imported Excel Workbook\"{[Item=\"mm\",Kind=\"Table\"]}[Data],\n    addKey = Table.AddColumn(getMMtbl, \"key\", each Text.Select(Text.Lower([MM]), {\"a\"..\"z\"}), type text),\r\n  Custom = addKey [key]\nin\n    Custom;\r\n","connectionOverrides":[{"path":"https://livettu-my.sharepoint.com/personal/siyi_ma_taltech_ee","kind":"SharePoint","provider":"CdsA","authenticationKind":null,"environmentName":null,"apiName":null,"connectionName":"{\"kind\":\"SharePoint\",\"path\":\"https://livettu-my.sharepoint.com/personal/siyi_ma_taltech_ee\"}","audience":null},{"path":"https://livettu.sharepoint.com/sites/M_admin","kind":"SharePoint","provider":"CdsA","authenticationKind":null,"environmentName":null,"apiName":null,"connectionName":"{\"kind\":\"SharePoint\",\"path\":\"https://livettu.sharepoint.com/sites/M_admin\"}","audience":null},{"path":"PowerPlatformDataflows","kind":"PowerPlatformDataflows","provider":"CdsA","authenticationKind":null,"environmentName":null,"apiName":null,"connectionName":"{\"kind\":\"PowerPlatformDataflows\",\"path\":\"PowerPlatformDataflows\"}","audience":null},{"path":"https://livettu.sharepoint.com/","kind":"SharePoint","provider":"CdsA","authenticationKind":null,"environmentName":null,"apiName":null,"connectionName":"{\"kind\":\"SharePoint\",\"path\":\"https://livettu.sharepoint.com/\"}","audience":null}]},"annotations":[{"name":"pbi:QueryGroups","value":"[{\"Id\":\"28f5432a-6996-4545-bf10-d2c5cdf1ecfa\",\"Name\":\"folder_lookup\",\"Description\":\"\",\"ParentId\":null,\"Order\":0}]"}],"entities":[{"$type":"LocalEntity","name":"MMkeskhinded_ja_komments","description":"","pbi:refreshPolicy":{"$type":"FullRefreshPolicy","location":"MMkeskhinded_ja_komments.parquet"},"annotations":[{"name":"ppdf:entityKeys","value":"[]"}],"attributes":[{"name":"teaduskond","dataType":"string"},{"name":"kava","dataType":"string"},{"name":"ainekood","dataType":"string"},{"name":"kysimus","dataType":"string"},{"name":"oppejou","dataType":"string"},{"name":"oppejoukey","dataType":"string"},{"name":"arv","dataType":"int64"},{"name":"keskmineHinne","dataType":"double"},{"name":"kommentaarKoond","dataType":"string"},{"name":"semester","dataType":"string"}]},{"$type":"LocalEntity","name":"MMettevotlus_alates24K","description":"","pbi:refreshPolicy":{"$type":"FullRefreshPolicy","location":"MMettevotlus_alates24K.parquet"},"annotations":[{"name":"pbi:EntityTypeDisplayHint","value":"CalculatedEntity"},{"name":"ppdf:entityKeys","value":"[]"}],"attributes":[{"name":"teaduskond","dataType":"string"},{"name":"kava","dataType":"string"},{"name":"ainekood","dataType":"string"},{"name":"kysimus","dataType":"string"},{"name":"oppejou","dataType":"string"},{"name":"oppejoukey","dataType":"string"},{"name":"arv","dataType":"int64"},{"name":"keskmineHinne","dataType":"double"},{"name":"kommentaarKoond","dataType":"string"},{"name":"semester","dataType":"string"},{"name":"tase","dataType":"string"},{"name":"oppegrupp","dataType":"string"}]}]}
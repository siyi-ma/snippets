{"name":"OIS_yliopilasteOtsingComparisonData","version":"1.0","culture":"en-US","modifiedTime":"2025-05-02T10:01:58.3274138+00:00","ppdf:outputFileFormat":"parquet","ppdf:dataflowId":"12a0c732-7f19-4d45-82db-c854081af734","ppdf:owner":{"tenantId":"3efd4d88-9b88-4fc9-b6c0-c7ca50f1db57","userId":"84427c2b-9e9c-4069-a4ef-32e34b3e92fb"},"ppdf:fastCopy":true,"pbi:mashup":{"fastCombine":false,"allowNativeQueries":true,"queriesMetadata":{"_getData":{"queryId":"c4326822-24d3-400a-bae1-b7c2608b804c","queryName":"_getData"},"_folderYliopilasteOtsing":{"queryId":"da57394f-0d1d-4edc-90c8-1fc200849f3a","queryName":"_folderYliopilasteOtsing"},"_folderOIS":{"queryId":"9e79be47-92cc-4ffa-b722-84a55386694b","queryName":"_folderOIS"},"latestDate":{"queryId":"fc32f286-0c91-4d7a-9fda-0bbbc1cb9e55","queryName":"latestDate"},"_comparisonFilePath":{"queryId":"92e4cdfa-7fff-40db-915d-d869c35037d2","queryName":"_comparisonFilePath"},"comparisonDate":{"queryId":"d7b8da14-0ae8-4d4b-a274-505e0ff2592f","queryName":"comparisonDate","loadEnabled":true},"comparisonData":{"queryId":"86283f55-98c5-4f55-8fba-15c95f76ba88","queryName":"comparisonData","loadEnabled":true},"_getOIS_yliopilasteOtsing":{"queryId":"2a35238a-02eb-46b4-8f49-480a26d13211","queryName":"_getOIS_yliopilasteOtsing"},"dim_kavatase":{"queryId":"735e9e55-b6ae-4fcb-bc9f-f338d2f8078b","queryName":"dim_kavatase","loadEnabled":true}},"document":"section Section1;\r\nshared _getData = let\n  Source = _getOIS_yliopilasteOtsing,\r\n  Navigation = Source{[entity = \"data\", version = \"\"]}[Data]\nin\n  Navigation;\r\nshared _folderYliopilasteOtsing = let\n    Source = _folderOIS,\n    folderCsv = Source {[Name=\"csv\"]}[Content],\n    folderOtsing = folderCsv{[Name= \"YliopilasteOtsing\"]}[Content],\n    #\"Sorted Rows\" = Table.Sort(folderOtsing,{{\"Date created\", Order.Descending}})\nin\n    #\"Sorted Rows\";\r\nshared _folderOIS = let \nSource = SharePoint.Contents(\"https://livettu-my.sharepoint.com/personal/siyi_ma_taltech_ee\"),\n    Documents = Source{[Name=\"Documents\"]}[Content], \n    folderOIS = Documents{[Name=\"OIS\"]}[Content]\nin folderOIS;\r\nshared latestDate = let\n  Source = _getOIS_yliopilasteOtsing,\r\n  Navigation = Source{[entity = \"latestDate\", version = \"\"]}[Data]{0}[Value]\nin\n  Navigation;\r\nshared _comparisonFilePath = let\n    Source = latestDate, \n    LY =Number.ToText(Number.FromText(Text.End(Source,4))-1),\n    CM = Text.Range(Source,3,2),\n    LM = Number.ToText(Number.FromText(CM)-1),\n    getValue = CM & \"_\"&LY, \n    getAltvalue = LM & \"_\"& LY, \n    getFolder = Table.AddColumn(_folderYliopilasteOtsing,\n        \"Custom\", each Text.Range([Name],3,7), type text),\n    getFilePath = Table.SelectRows(getFolder, each Text.Contains( [Name], getAltvalue)) \nin\n    getFilePath;\r\nshared comparisonDate = let\n    Source = _comparisonFilePath,\n    Custom1 = Date.ToText(Date.From(Source [Date created]{0}), [Culture=\"de-DE\"]),\r\n  #\"From Value\" = Table.FromValue(Custom1)\nin\n    #\"From Value\";\r\nshared comparisonData = let\n    Source = _comparisonFilePath,\n    getCsv = Csv.Document(\n(Source{0}[Content]),[Delimiter=\";\", Columns=12, Encoding=65001, QuoteStyle=QuoteStyle.None]),\n  colList = List.RemoveRange(List.Skip(Table.ColumnNames( getCsv),3),3,1),\n  Custom = Table.SelectColumns(getCsv, colList),\n  replacewithcomma = Table.ReplaceValue(Custom, \".\", \",\", Replacer.ReplaceText, {\"Column10\", \"Column11\"}),\n    transformData = Table.AddColumn( \nTable.TransformColumnTypes( \nTable.PromoteHeaders(replacewithcomma, [PromoteAllScalars=true]),\n{{\"EAP\", type number}, {\"KKH (EAP)\", type number}}, \"de-DE\"),\n\"kava\", each Text.Middle([üliõpilaskood], 6, 4), type text)\nin\n    transformData;\r\nshared _getOIS_yliopilasteOtsing = let\r\n  Source = PowerPlatform.Dataflows([]),\r\n  #\"Navigation 1\" = Source{[Id = \"Workspaces\"]}[Data],\r\n  #\"Navigation 2\" = #\"Navigation 1\"{[workspaceId = \"b9ba0143-b2c1-4295-a8d9-0844282bd555\"]}[Data],\r\n  #\"Navigation 3\" = #\"Navigation 2\"{[dataflowId = \"92d7cda3-c056-4160-a77b-e5b024d8be20\"]}[Data]\r\nin\r\n  #\"Navigation 3\";\r\nshared dim_kavatase = let\n  crrtKava = Table.Distinct(Table.SelectColumns(_getData, {\"kava\"})),\n  compKava = Table.Distinct(Table.SelectColumns(comparisonData, {\"kava\"})),\n  kavacombine = Table.Distinct( Table.Combine ({crrtKava, compKava})),\n  addTase = Table.Sort(Table.AddColumn(kavacombine, \"tase\", each let _value = Text.Middle([kava],3,1), result = if _value=\"B\" then \"BAK\" else if _value = \"M\" then \"MAG\" else if _value=\"D\" then \"_DOK\" else \"NA\" in result, type text), {{\"tase\", Order.Ascending}, {\"kava\", Order.Ascending}}),\n  #\"Added index\" = Table.AddIndexColumn(addTase, \"Index\", 0, 1, Int64.Type)\nin\n  #\"Added index\";\r\n","connectionOverrides":[{"path":"PowerPlatformDataflows","kind":"PowerPlatformDataflows","provider":"CdsA","authenticationKind":null,"environmentName":null,"apiName":null,"connectionName":"{\"kind\":\"PowerPlatformDataflows\",\"path\":\"PowerPlatformDataflows\"}","audience":null},{"path":"https://livettu-my.sharepoint.com/personal/siyi_ma_taltech_ee","kind":"SharePoint","provider":"CdsA","authenticationKind":null,"environmentName":null,"apiName":null,"connectionName":"{\"kind\":\"SharePoint\",\"path\":\"https://livettu-my.sharepoint.com/personal/siyi_ma_taltech_ee\"}","audience":null}]},"entities":[{"$type":"LocalEntity","name":"comparisonDate","description":"","pbi:refreshPolicy":{"$type":"FullRefreshPolicy","location":"comparisonDate.parquet"},"annotations":[{"name":"ppdf:entityKeys","value":"[]"}],"attributes":[{"name":"Value","dataType":"string"}]},{"$type":"LocalEntity","name":"comparisonData","description":"","pbi:refreshPolicy":{"$type":"FullRefreshPolicy","location":"comparisonData.parquet"},"annotations":[{"name":"ppdf:entityKeys","value":"[]"}],"attributes":[{"name":"isiku sugu","dataType":"string"},{"name":"kodakondsus","dataType":"string"},{"name":"üliõpilaskood","dataType":"string"},{"name":"õppekoormus","dataType":"string"},{"name":"akadeemilisel puhkusel/õppimine peatatud","dataType":"string"},{"name":"EAP","dataType":"double"},{"name":"KKH (EAP)","dataType":"double"},{"name":"välisüliõpilane","dataType":"string"},{"name":"kava","dataType":"string"}]},{"$type":"LocalEntity","name":"dim_kavatase","description":"","pbi:refreshPolicy":{"$type":"FullRefreshPolicy","location":"dim_kavatase.parquet"},"annotations":[{"name":"pbi:EntityTypeDisplayHint","value":"CalculatedEntity"},{"name":"ppdf:entityKeys","value":"[{\"columns\":[\"kava\"]}]"}],"attributes":[{"name":"kava","dataType":"string"},{"name":"tase","dataType":"string"},{"name":"Index","dataType":"int64"}]}]}
{"name":"OIS_yliopilasteOtsing","version":"1.0","culture":"en-US","modifiedTime":"2025-05-03T07:57:37.4450534+00:00","ppdf:outputFileFormat":"parquet","ppdf:dataflowId":"92d7cda3-c056-4160-a77b-e5b024d8be20","ppdf:owner":{"tenantId":"3efd4d88-9b88-4fc9-b6c0-c7ca50f1db57","userId":"84427c2b-9e9c-4069-a4ef-32e34b3e92fb"},"ppdf:fastCopy":true,"pbi:mashup":{"fastCombine":false,"allowNativeQueries":true,"queriesMetadata":{"_folderOIS":{"queryId":"cf129c9c-1cd8-4880-b6dc-cb44950f1261","queryName":"_folderOIS"},"_folderYliopilasteOtsing":{"queryId":"bd6c2927-4a0d-4a5b-828a-d9174896b947","queryName":"_folderYliopilasteOtsing"},"_testKKH":{"queryId":"470a83d2-6eb5-4a3d-9f13-680f9faf7be7","queryName":"_testKKH"},"fnKKH":{"queryId":"71ab2edd-55f0-4e6d-a46f-d445ed66c76b","queryName":"fnKKH"},"data":{"queryId":"3e7f7cce-7f57-4a37-acfb-390f9f68541c","queryName":"data","loadEnabled":true},"_lookupYliopilaskood":{"queryId":"7b995c53-289a-4078-b762-ba603f790cad","queryName":"_lookupYliopilaskood"},"_folderDekanaadiKauduImmat":{"queryId":"5123b0fa-197d-47c8-bbb4-89f9df8eb8dd","queryName":"_folderDekanaadiKauduImmat"},"_lookupKavalist":{"queryId":"638a7029-f811-4d6e-839d-2e5acc2c6999","queryName":"_lookupKavalist"},"latestDate":{"queryId":"83ff53a3-c031-4c40-ae11-33bbced2fc95","queryName":"latestDate","loadEnabled":true},"_comparisonFilePath":{"queryId":"8ddb86e9-e902-4257-bce7-653845252f06","queryName":"_comparisonFilePath"},"comparisonDate":{"queryId":"ae98c0ee-fcc2-4d6e-bed8-75896df677b6","queryName":"comparisonDate"},"comparisonData":{"queryId":"bc159c5e-ce9a-488a-bbe5-af1ba5334eca","queryName":"comparisonData"},"dim_kavatase":{"queryId":"9abe0a22-14c7-428f-9c6a-2342a82ad5ad","queryName":"dim_kavatase"},"_folderOIS_EsilehtStat":{"queryId":"e286a7b2-fcd2-4578-a334-1faaa106ae23","queryName":"_folderOIS_EsilehtStat"},"fakt_OIS_oppuritearv_al2015":{"queryId":"2a00611c-e719-49b3-be2f-acaa0344a3e9","queryName":"fakt_OIS_oppuritearv_al2015","loadEnabled":true},"_testOIS_oppuritearv_al2015":{"queryId":"a4a9a6b6-9213-414d-bd46-06422a92a31c","queryName":"_testOIS_oppuritearv_al2015"},"dim_oppuritearv_calendar":{"queryId":"c61f48df-428f-4bd2-937b-d818e410385d","queryName":"dim_oppuritearv_calendar"}},"document":"section Section1;\r\nshared _folderOIS = let \nSource = SharePoint.Contents(\"https://livettu-my.sharepoint.com/personal/siyi_ma_taltech_ee\"),\n    Documents = Source{[Name=\"Documents\"]}[Content], \n    folderOIS = Documents{[Name=\"OIS\"]}[Content]\nin folderOIS;\r\nshared _folderYliopilasteOtsing = let\n    Source = _folderOIS,\n    folderCsv = Source {[Name=\"csv\"]}[Content],\n    folderOtsing = folderCsv{[Name= \"YliopilasteOtsing\"]}[Content],\n    #\"Sorted Rows\" = Table.Sort(folderOtsing,{{\"Date created\", Order.Descending}})\nin\n    #\"Sorted Rows\";\r\nshared _testKKH = let\n  Source = _folderYliopilasteOtsing,\n  Navigation = Source{0}[Content],\n  #\"Imported CSV\" = Csv.Document(Navigation, [Delimiter = \";\", Columns = 15, Encoding = 65001, QuoteStyle = QuoteStyle.None]),\r\n  colNames = List.Skip( Table.ColumnNames(#\"Imported CSV\"), 1),\r\n  Custom = Table.SelectColumns(#\"Imported CSV\",  colNames),\n  #\"Promoted headers\" = Table.PromoteHeaders(Custom, [PromoteAllScalars = true]),\n  #\"Changed column type\" = Table.TransformColumnTypes(#\"Promoted headers\", {{\"sünnikuupäev\", type date}, {\"isikukood\", Int64.Type}, {\"isiku sugu\", type text}, {\"kodakondsus\", type text}, {\"üliõpilaskood\", type text}, {\"peaeriala/eriala\", type text}, {\"õppekoormus\", type text}, {\"akadeemilisel puhkusel/õppimine peatatud\", type text}, {\"EAP\", type number}, {\"KKH (EAP)\", type number}, {\"välisüliõpilane\", type text}, {\"SEL\", Int64.Type}, {\"õpitud semestrite arv\", Int64.Type}, {\"akad. puhkusel sem. arv  \", Int64.Type}}, \"de-DE\"),\n  #\"Removed other columns\" = Table.SelectColumns(#\"Changed column type\", {\"üliõpilaskood\", \"EAP\", \"KKH (EAP)\"})\nin\n  #\"Removed other columns\";\r\nshared fnKKH = let\r\n  fnKKH = (input as binary) => \nlet \n#\"Imported CSV\" = Csv.Document(input, [Delimiter = \";\", Columns = 12, Encoding = 65001, QuoteStyle = QuoteStyle.None]),\n  #\"Promoted headers\" = Table.PromoteHeaders(#\"Imported CSV\", [PromoteAllScalars = true]),\n  #\"Removed other columns\" = Table.SelectColumns(#\"Changed column type\", {\"üliõpilaskood\", \"EAP\", \"KKH (EAP)\"}),\n  ColType = Table.TransformColumnTypes(#\"Removed other columns\", {{\"üliõpilaskood\", type text}, {\"EAP\", type number}, {\"KKH (EAP)\", type number}}) \nin\n  ColType\r\nin\r\n  fnKKH;\r\nshared data = let\n    Source = _folderYliopilasteOtsing,\n    getCsv = Table.FirstN(Table.Sort(Table.SelectRows(Source, each [Extension] = \".csv\"), {{\"Date created\", Order.Descending}}),1){0}[Content],\n  Custom = Table.PromoteHeaders( Table.RemoveColumns( Csv.Document(getCsv, [Delimiter = \";\", Columns= 12, Encoding = 1257]), \"Column1\")),\n  #\"Replaced value\" = Table.ReplaceValue(Custom, \".\", \",\", Replacer.ReplaceText, {\"EAP\", \"KKH (EAP)\"}),\n  #\"Changed column type\" = Table.TransformColumnTypes(#\"Replaced value\", {{\"sünnikuupäev\", type date}, {\"isikukood\", Int64.Type}, {\"isiku sugu\", type text}, {\"kodakondsus\", type text}, {\"üliõpilaskood\", type text}, {\"peaeriala/eriala\", type text}, {\"õppekoormus\", type text}, {\"akadeemilisel puhkusel/õppimine peatatud\", type text}, {\"EAP\", Int64.Type}, {\"KKH (EAP)\", type number}, {\"välisüliõpilane\", type text}}, \"de-DE\"),\n  addVanu = Table.AddColumn(#\"Changed column type\", \"vanu\", each let today = Date.From(DateTime.LocalNow()),  result = Duration.Days(today - [sünnikuupäev])/365 in result, type number),\n  addKavaTase = Table.AddColumn(\n    Table.AddColumn(addVanu, \n    \"kava\", each Text.Middle([üliõpilaskood], 6, 4), type text),\n    \"tase\", each Text.Middle([üliõpilaskood], 9, 1), type text)\n//   #\"Renamed columns\" = Table.RenameColumns(addKavaTase, {{\"akadeemilisel puhkusel/õppimine peatatud\", \"akadeemilisel puhkusel\"}, {\"peaeriala/eriala\", \"peaeriala\"}})\nin addKavaTase;\r\nshared _lookupYliopilaskood = let\n  Source = PowerPlatform.Dataflows([]),\n  #\"Navigation 1\" = Source{[Id = \"Workspaces\"]}[Data],\n  #\"Navigation 2\" = #\"Navigation 1\"{[workspaceId = \"27199d8c-d350-4e48-a6c0-f4ad9789c7cc\"]}[Data],\n  #\"Navigation 3\" = #\"Navigation 2\"{[dataflowId = \"da705c97-13fc-4395-985f-e122384191c4\"]}[Data],\n  #\"Navigation 4\" = #\"Navigation 3\"{[entity = \"fakt_data\", version = \"\"]}[Data],\n  #\"Removed other columns\" = Table.SelectColumns(#\"Navigation 4\", {\"yliopilaskood\"})\nin\n  #\"Removed other columns\";\r\nshared _folderDekanaadiKauduImmat = let\n    Source = SharePoint.Contents(\"https://livettu.sharepoint.com/sites/M_Dashboard\"),\n    Documents = Source{[Name=\"M_õppetöö\"]}[Content],\n  Navigation = Documents{[Name = \"dekanaadiKauduImmat\"]}[Content]\nin Navigation;\r\nshared _lookupKavalist = let\n  Source = _folderDekanaadiKauduImmat,\n  Navigation = Excel.Workbook( Source{[Name = \"dekaaniKauduImmatrikuleerimine.xlsx\"]}[Content]),\n  #\"Navigation 1\" = Navigation{[Item = \"kava\", Kind = \"DefinedName\"]}[Data][Column1]\nin\n  #\"Navigation 1\";\r\nshared latestDate = let\n  Source = _folderYliopilasteOtsing,\n  getName = Date.ToText( Date.From( Source[Date created]{0}), [Culture = \"de-DE\"]),\n  getDate = Text.Replace( Text.Start(getName, 10), \"_\", \".\"),\r\n  #\"From Value\" = Table.FromValue(getDate)\nin\n  #\"From Value\";\r\nshared _comparisonFilePath = let\n    Source = latestDate, \n    LY =Number.ToText(Number.FromText(Text.End(Source,4))-1),\n    CM = Text.Range(Source,3,2),\n    LM = Number.ToText(Number.FromText(CM)-1),\n    getValue = CM & \"_\"&LY, \n    getAltvalue = LM & \"_\"& LY, \n    getFolder = Table.AddColumn(_folderYliopilasteOtsing,\n        \"Custom\", each Text.Range([Name],3,7), type text),\n    getFilePath = Table.SelectRows(getFolder, each Text.Contains( [Name], getAltvalue)) \nin\n    getFilePath;\r\nshared comparisonDate = let\n    Source = _comparisonFilePath,\n    Custom1 = Date.ToText(Date.From(Source [Date created]{0}), [Culture=\"de-DE\"])\nin\n    Custom1;\r\nshared comparisonData = let\n    Source = _comparisonFilePath,\n    getCsv = Csv.Document(\n(Source{0}[Content]),[Delimiter=\";\", Columns=12, Encoding=65001, QuoteStyle=QuoteStyle.None]),\n  colList = List.RemoveRange(List.Skip(Table.ColumnNames( getCsv),3),3,1),\n  Custom = Table.SelectColumns(getCsv, colList),\n  replacewithcomma = Table.ReplaceValue(Custom, \".\", \",\", Replacer.ReplaceText, {\"Column10\", \"Column11\"}),\n    transformData = Table.AddColumn( \nTable.TransformColumnTypes( \nTable.PromoteHeaders(replacewithcomma, [PromoteAllScalars=true]),\n{{\"EAP\", type number}, {\"KKH (EAP)\", type number}}, \"de-DE\"),\n\"kava\", each Text.Middle([üliõpilaskood], 6, 4), type text)\nin\n    transformData;\r\nshared dim_kavatase = let\n  crrtKava = Table.Distinct(Table.SelectColumns(data, {\"kava\"})),\n  compKava = Table.Distinct(Table.SelectColumns(comparisonData, {\"kava\"})),\n  kavacombine = Table.Distinct( Table.Combine ({crrtKava, compKava})),\n  addTase = Table.Sort(Table.AddColumn(kavacombine, \"tase\", each let _value = Text.Middle([kava],3,1), result = if _value=\"B\" then \"BAK\" else if _value = \"M\" then \"MAG\" else if _value=\"D\" then \"_DOK\" else \"NA\" in result, type text), {{\"tase\", Order.Ascending}, {\"kava\", Order.Ascending}}),\n  #\"Added index\" = Table.AddIndexColumn(addTase, \"Index\", 0, 1, Int64.Type)\nin\n  #\"Added index\";\r\nshared _folderOIS_EsilehtStat = let\r\n  Source = _folderOIS,\r\n  Navigation = Source{[Name = \"OIS Esileht Statistika\"]}[Content]\r\nin\r\n  Navigation;\r\nshared fakt_OIS_oppuritearv_al2015 = let\n  Source = _folderOIS_EsilehtStat,\n  filterFiles = Table.SelectColumns(Table.SelectRows(Source, each Text.StartsWith([Name], \"OIS õppurite arv\")), {\"Content\", \"Name\"}),\n  addXslx_dataTbl = Table.AddColumn(filterFiles, \"dataTbl\", each Excel.Workbook([Content], true){0}[Data]),\n  tblCombine = Table.SelectColumns(Table.Combine(addXslx_dataTbl[dataTbl]), {\"kuupäev\", \"teaduskond\", \"kava versioon\", \"õppuri tüüp\", \"õppureid kokku\"}),\n  tblTransform = Table.RenameColumns(\nTable.RemoveColumns( Table.SelectRows( Table.TransformColumns( tblCombine, {{\"kava versioon\", each Text.Start(_, 4), type text}}),\n    each ([õppuri tüüp] = \"üliõpilane\")), {\"teaduskond\", \"õppuri tüüp\"}),\n {{\"kava versioon\", \"kava\"}}),\n  #\"Changed column type\" = Table.TransformColumnTypes(tblTransform, {{\"kuupäev\", type date}, {\"õppureid kokku\", Int64.Type}}, \"de-DE\"),\n  tblGroup = Table.Sort( Table.Group(#\"Changed column type\",\n    {\"kuupäev\", \"kava\"}, {{\"arv\", each List.Sum([õppureid kokku]), Int64.Type}}),\n    {{\"kuupäev\", Order.Descending}}),\r\n  Custom = Table.SelectRows(tblGroup, each not Text.StartsWith([kava], \"#(tab)\"))\nin\n  Custom;\r\nshared _testOIS_oppuritearv_al2015 = let\n  Source = _folderOIS_EsilehtStat,\n  filterFiles = Table.SelectColumns(Table.SelectRows(Source, each Text.StartsWith([Name], \"OIS õppurite arv\")), {\"Content\", \"Name\"}),\n  addXslx_dataTbl = Table.AddColumn(filterFiles, \"dataTbl\", each Excel.Workbook([Content], true){0}[Data]),\n  tblCombine = Table.SelectColumns(Table.Combine(addXslx_dataTbl[dataTbl]), {\"kuupäev\", \"teaduskond\", \"kava versioon\", \"õppuri tüüp\", \"õppureid kokku\"}),\n  tblTransform = Table.RenameColumns(\nTable.RemoveColumns( Table.SelectRows( Table.TransformColumns( tblCombine, {{\"kava versioon\", each Text.Start(_, 4), type text}}),\n    each ([õppuri tüüp] = \"üliõpilane\")), {\"teaduskond\", \"õppuri tüüp\"}),\n {{\"kava versioon\", \"kava\"}}),\r\n  #\"Changed column type\" = Table.TransformColumnTypes(tblTransform, {{\"kuupäev\", type date}, {\"õppureid kokku\", Int64.Type}}, \"de-DE\"),\n  tblGroup = Table.Sort( Table.Group(#\"Changed column type\",\n    {\"kuupäev\", \"kava\"}, {{\"arv\", each List.Sum([õppureid kokku]), Int64.Type}}),\n    {{\"kuupäev\", Order.Descending}}),\n  tblClean = Table.SelectRows(tblGroup, each Text.Length([kava]) = 4),\n  addTase = Table.AddColumn(tblClean, \"tase\", each let extracttext = Text.End([kava], 1), result = if extracttext = \"B\" then \"BAK\" else if extracttext = \"M\" then \"MAG\" else if extracttext = \"D\" then \"_DOK\" else if extracttext = \"R\" then  \"RAK\" else \"NA\" in result, type text)\nin\n  addTase;\r\nshared dim_oppuritearv_calendar = let\r\n  Source = fakt_OIS_oppuritearv_al2015,\r\n  #\"Removed other columns\" = Table.Distinct( Table.SelectColumns(Source, {\"kuupäev\"})),\r\n  #\"Added custom\" = Table.AddColumn(#\"Removed other columns\", \"aasta\", each Date.Year([kuupäev]), Int64.Type),\r\n  #\"Added custom 1\" = Table.AddColumn(#\"Added custom\", \"kuuNUM\", each Date.Month([kuupäev]), Int64.Type),\r\n  #\"Added custom 2\" = Table.AddColumn(#\"Added custom 1\", \"kuu\", each Date.ToText([kuupäev], \"MMM\", \"et-ET\"), type text)\r\nin\r\n  #\"Added custom 2\";\r\n","connectionOverrides":[{"path":"https://livettu-my.sharepoint.com/personal/siyi_ma_taltech_ee","kind":"SharePoint","provider":"CdsA","authenticationKind":null,"environmentName":null,"apiName":null,"connectionName":"{\"kind\":\"SharePoint\",\"path\":\"https://livettu-my.sharepoint.com/personal/siyi_ma_taltech_ee\"}","audience":null},{"path":"PowerPlatformDataflows","kind":"PowerPlatformDataflows","provider":"CdsA","authenticationKind":null,"environmentName":null,"apiName":null,"connectionName":"{\"kind\":\"PowerPlatformDataflows\",\"path\":\"PowerPlatformDataflows\"}","audience":null},{"path":"https://livettu.sharepoint.com/","kind":"SharePoint","provider":"CdsA","authenticationKind":null,"environmentName":null,"apiName":null,"connectionName":"{\"kind\":\"SharePoint\",\"path\":\"https://livettu.sharepoint.com/\"}","audience":null}]},"entities":[{"$type":"LocalEntity","name":"data","description":"","pbi:refreshPolicy":{"$type":"FullRefreshPolicy","location":"data.parquet"},"annotations":[{"name":"ppdf:entityKeys","value":"[]"}],"attributes":[{"name":"sünnikuupäev","dataType":"date"},{"name":"isikukood","dataType":"int64"},{"name":"isiku sugu","dataType":"string"},{"name":"kodakondsus","dataType":"string"},{"name":"üliõpilaskood","dataType":"string"},{"name":"peaeriala/eriala","dataType":"string"},{"name":"õppekoormus","dataType":"string"},{"name":"akadeemilisel puhkusel/õppimine peatatud","dataType":"string"},{"name":"EAP","dataType":"int64"},{"name":"KKH (EAP)","dataType":"double"},{"name":"välisüliõpilane","dataType":"string"},{"name":"vanu","dataType":"double"},{"name":"kava","dataType":"string"},{"name":"tase","dataType":"string"}]},{"$type":"LocalEntity","name":"latestDate","description":"","pbi:refreshPolicy":{"$type":"FullRefreshPolicy","location":"latestDate.parquet"},"annotations":[{"name":"ppdf:entityKeys","value":"[]"}],"attributes":[{"name":"Value","dataType":"string"}]},{"$type":"LocalEntity","name":"fakt_OIS_oppuritearv_al2015","description":"","pbi:refreshPolicy":{"$type":"FullRefreshPolicy","location":"fakt_OIS_oppuritearv_al2015.parquet"},"annotations":[{"name":"ppdf:entityKeys","value":"[{\"columns\":[\"kuupäev\",\"kava\"]}]"}],"attributes":[{"name":"kuupäev","dataType":"date"},{"name":"kava","dataType":"string"},{"name":"arv","dataType":"int64"}]}]}